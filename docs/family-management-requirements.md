# 가족관리 시스템 요구사항 정의서

## 📋 문서 정보
- **작성일**: 2024-12-19
- **버전**: 1.0
- **프로젝트**: ITTLC 교회 관리 시스템
- **담당자**: 개발팀

## 🎯 개요 및 목적

### 목적
교회 내 성도들의 가족 관계를 체계적으로 관리하여 가족 단위의 목양 및 활동 지원을 효율화합니다.

### 배경
- 가족 단위 목양 및 관리 필요성 증대
- 가족 관계 정보의 체계적 관리 요구
- 가족 단위 통계 및 현황 파악 필요
- 가족 구성원 간 연락처 공유 및 관리
- 가족 단위 헌금 및 활동 관리 지원

### 핵심 가치
- **가족 중심 목양**: 개인이 아닌 가족 단위의 접근
- **관계 중심 관리**: 가족 구성원 간의 관계 명확화
- **통합 관리**: 개별 성도 정보와 가족 정보의 연계
- **개인정보 보호**: 가족 내 개인정보 접근 권한 관리

## 🏗️ 시스템 구조

### 메뉴 위치
```
├── 대시보드
├── 성도관리
├── 가족관리 ← 현재 문서
│   ├── 가족 조회
│   ├── 가족 등록
│   ├── 구성원 관리
│   └── 가족 통계
├── 기도
├── 헌금
└── 관리자
```

### 접근 경로
- **가족 조회**: `/main/families/view`
- **가족 등록**: `/main/families/register`
- **구성원 관리**: `/main/families/members/:familyId`
- **가족 통계**: `/main/families/statistics`

## 🚀 기능 요구사항

### 1. 가족 조회 기능

#### 1.1 가족 목록 조회
**기본 기능**
- 전체 가족 목록 표시
- 페이지네이션 처리 (20가족씩)
- 가족별 기본 정보 카드 형태 표시
- 정렬 기능 (가족명, 등록일, 구성원 수)

**표시 정보**
- 가족명
- 가족 대표자 (호주)
- 구성원 수
- 주소 (간략)
- 등록일
- 최근 활동일

#### 1.2 검색 및 필터링
**검색 기능**
- 가족명 검색 (부분 검색 지원)
- 가족 대표자 이름 검색
- 주소 검색 (동, 구 단위)
- 구성원 이름으로 가족 검색

**필터링 옵션**
- 구성원 수별 필터 (1명, 2-3명, 4-5명, 6명 이상)
- 연령대별 필터 (신혼, 청년, 중장년, 노년)
- 활동 상태별 필터 (활발, 보통, 휴면)
- 등록 기간별 필터

#### 1.3 가족 상세 조회
**가족 기본 정보**
- 가족명 및 호칭
- 가족 대표자 정보
- 가족 주소
- 등록일 및 수정 이력

**구성원 정보**
- 구성원 목록 (관계별 정렬)
- 각 구성원별 기본 정보
- 가족 내 역할 및 관계
- 개별 연락처 정보

**가족 활동 현황**
- 가족 단위 출석 현황
- 가족 단위 헌금 현황
- 가족 단위 활동 참여 이력
- 가족 단위 기도 제목

### 2. 가족 등록 기능

#### 2.1 신규 가족 등록
**가족 기본 정보 입력**
- 가족명 (필수)
- 가족 주소 (선택)
- 가족 대표자 지정 (필수)
- 등록일 (기본값: 오늘 날짜)

**가족 대표자 설정**
- 기존 성도 중 선택
- 신규 성도 동시 등록
- 대표자 권한 및 책임 안내

#### 2.2 기존 성도의 가족 정보 설정
**개별 가족 생성**
- 기존 등록된 성도 대상
- 1인 가족으로 시작
- 추후 구성원 추가 가능

**기존 가족 합류**
- 기존 가족 검색
- 가족 관계 설정
- 가족 대표자 승인 (옵션)

### 3. 구성원 관리 기능

#### 3.1 구성원 추가
**기존 성도 추가**
- 성도 검색 및 선택
- 가족 관계 설정 (부, 모, 자녀, 기타)
- 추가 승인 프로세스

**신규 성도 추가**
- 가족 등록과 동시에 성도 등록
- 가족 관계 자동 설정
- 기본 정보 상속 (주소 등)

#### 3.2 구성원 관계 관리
**관계 유형**
- 부 (Father)
- 모 (Mother)  
- 자녀 (Son/Daughter)
- 조부모 (Grandfather/Grandmother)
- 기타 (Other - 직접 입력)

**관계 변경**
- 기존 관계 수정
- 관계 변경 이력 기록
- 변경 사유 기록

#### 3.3 구성원 제거
**가족에서 분리**
- 개별 성도는 유지, 가족 관계만 해제
- 분리 사유 기록
- 분리 후 개별 가족 생성 옵션

**완전 삭제**
- 관리자 권한 필요
- 삭제 사유 기록 필수
- 관련 데이터 처리 방안

### 4. 가족 통계 기능

#### 4.1 전체 가족 통계
**기본 통계**
- 총 가족 수
- 평균 가족 구성원 수
- 가족 유형별 분포 (1인, 2인, 3인 이상)
- 연령대별 가족 분포

**활동 통계**
- 가족 단위 출석률
- 가족 단위 헌금 참여율
- 가족 단위 활동 참여율

#### 4.2 개별 가족 통계
**출석 현황**
- 가족 구성원별 출석률
- 가족 전체 출석률
- 월별/연도별 출석 추이

**헌금 현황**
- 가족 단위 헌금 내역
- 구성원별 헌금 기여도
- 헌금 유형별 참여 현황

**활동 참여 현황**
- 교회 활동 참여 이력
- 구성원별 참여 활동
- 가족 단위 참여 프로그램

## 🗃️ 데이터 구조

### 가족 테이블 (families)
```sql
CREATE TABLE families (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    family_name VARCHAR(100) NOT NULL,          -- 가족명
    head_member_id INTEGER,                     -- 가족 대표자 ID
    address TEXT,                               -- 가족 주소
    description TEXT,                           -- 가족 설명
    is_active BOOLEAN DEFAULT TRUE,             -- 활성 상태
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    created_by INTEGER NOT NULL,
    FOREIGN KEY (head_member_id) REFERENCES members(id),
    FOREIGN KEY (created_by) REFERENCES users(id)
);
```

### 성도 테이블 가족 관련 필드 (members)
```sql
-- 기존 members 테이블에 추가되는 필드
ALTER TABLE members ADD COLUMN family_id INTEGER;
ALTER TABLE members ADD COLUMN family_role VARCHAR(20); -- 가족 내 역할
ALTER TABLE members ADD FOREIGN KEY (family_id) REFERENCES families(id);
```

### 가족 관계 히스토리 테이블 (family_history)
```sql
CREATE TABLE family_history (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    family_id INTEGER NOT NULL,
    member_id INTEGER NOT NULL,
    action_type VARCHAR(20) NOT NULL,           -- 'join', 'leave', 'role_change'
    old_role VARCHAR(20),
    new_role VARCHAR(20),
    reason TEXT,
    created_by INTEGER NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (family_id) REFERENCES families(id),
    FOREIGN KEY (member_id) REFERENCES members(id),
    FOREIGN KEY (created_by) REFERENCES users(id)
);
```

### 가족 통계 뷰 (family_statistics_view)
```sql
CREATE VIEW family_statistics_view AS
SELECT 
    f.id,
    f.family_name,
    COUNT(m.id) as member_count,
    MIN(m.birth_date) as oldest_birth_date,
    MAX(m.birth_date) as youngest_birth_date,
    f.head_member_id,
    f.address,
    f.created_at
FROM families f
LEFT JOIN members m ON f.id = m.family_id AND m.is_active = TRUE
WHERE f.is_active = TRUE
GROUP BY f.id;
```

## 🎨 UI/UX 요구사항

### 가족 조회 페이지
#### 레이아웃 구조
```
[헤더: 가족 조회 + 검색바 + 필터 + 등록 버튼]
[필터 옵션 패널 (접이식)]
[가족 카드 그리드 레이아웃]
[페이지네이션]
```

#### 가족 카드 디자인
- **카드 크기**: 300px × 200px
- **주요 정보**: 가족명, 대표자, 구성원 수, 주소
- **아이콘**: 가족 구성원 수 표시 아이콘
- **상태 표시**: 활동 상태 컬러 인디케이터
- **액션**: 상세보기, 편집 버튼

### 가족 상세 페이지
#### 정보 섹션 구성
1. **가족 기본 정보** (상단)
2. **구성원 목록** (중앙, 관계별 그룹핑)
3. **활동 현황** (하단, 탭 형태)

#### 구성원 표시 방식
- **관계별 그룹핑**: 부모 → 자녀 → 기타 순서
- **카드 형태**: 사진, 이름, 나이, 연락처
- **관계 표시**: 아이콘 + 텍스트
- **액션 버튼**: 상세보기, 관계수정, 제거

### 가족 등록/편집 페이지
#### 단계별 진행
1. **Step 1**: 가족 기본 정보 입력
2. **Step 2**: 가족 대표자 설정
3. **Step 3**: 구성원 추가 (선택)
4. **Step 4**: 확인 및 저장

#### 폼 디자인
- **반응형 레이아웃**: 모바일 친화적
- **실시간 검증**: 입력 시 즉시 유효성 검사
- **자동완성**: 기존 데이터 기반 제안
- **진행 표시**: 프로그레스 바

### 구성원 관리 페이지
#### 인터페이스 요소
- **드래그 앤 드롭**: 관계 재설정
- **관계 다이어그램**: 가족 관계도 시각화
- **빠른 추가**: 검색 → 선택 → 관계설정 원스텝
- **일괄 처리**: 여러 구성원 동시 처리

## 🔒 권한 및 보안

### 접근 권한 관리
#### 권한 레벨
1. **관리자**: 모든 가족 정보 조회/수정/삭제
2. **가족 대표자**: 본인 가족 정보 조회/수정
3. **가족 구성원**: 본인 가족 정보 조회만
4. **일반 사용자**: 제한된 가족 정보만 조회

#### 개인정보 보호
- **민감 정보 마스킹**: 연락처, 주소 부분 마스킹
- **접근 로그**: 가족 정보 접근 이력 기록
- **동의 관리**: 가족 정보 공개 동의 설정
- **데이터 암호화**: 민감 정보 암호화 저장

### 가족 구성원 권한
#### 정보 공개 범위 설정
- **가족 내 공개**: 가족 구성원에게만 공개
- **교회 내 공개**: 교회 구성원에게 공개
- **관리자만**: 관리자에게만 공개
- **비공개**: 본인만 접근 가능

## 📊 통계 및 리포트

### 대시보드 위젯
#### 주요 지표
- **가족 현황**: 총 가족 수, 신규 등록 가족
- **구성원 분포**: 1인 가족, 다인 가족 비율
- **활동 지표**: 가족 단위 출석률, 참여율
- **연령 분포**: 가족 연령대별 분포도

### 정기 리포트
#### 월간 가족 현황 리포트
- 신규 등록 가족
- 구성원 변동 사항
- 가족 단위 활동 참여 현황
- 연락처 업데이트 현황

#### 연간 가족 통계 리포트
- 가족 구성 변화 추이
- 가족 단위 성장 지표
- 세대별 가족 분포 변화
- 지역별 가족 분포 현황

## 🔄 연동 및 통합

### 성도관리 시스템 연동
- **자동 동기화**: 성도 정보 변경 시 가족 정보 자동 업데이트
- **중복 방지**: 가족 등록 시 기존 성도 정보 활용
- **관계 검증**: 가족 관계의 논리적 일관성 검증

### 출석관리 시스템 연동
- **가족 단위 출석**: 가족 구성원별 출석 현황 통합 표시
- **가족 출석률**: 가족 전체 출석률 계산 및 표시
- **출석 알림**: 가족 구성원 부재 시 알림 기능

### 헌금관리 시스템 연동
- **가족 단위 헌금**: 가족 구성원별 헌금 통합 관리
- **가족 헌금 통계**: 가족 단위 헌금 현황 및 통계
- **헌금 영수증**: 가족 단위 헌금 영수증 발행

## 🚀 구현 우선순위

### Phase 1: 핵심 기능 (2주)
- [ ] 가족 CRUD 기본 기능
- [ ] 구성원 추가/제거 기능
- [ ] 가족 조회 및 검색
- [ ] 기본 권한 관리

### Phase 2: 고급 기능 (2주)  
- [ ] 가족 관계 다이어그램
- [ ] 가족 통계 대시보드
- [ ] 다른 시스템과의 연동
- [ ] 고급 검색 및 필터링

### Phase 3: 최적화 및 확장 (1주)
- [ ] 성능 최적화
- [ ] 모바일 최적화
- [ ] 접근성 개선
- [ ] 리포트 기능 강화

## 📋 테스트 시나리오

### 기능 테스트
#### 가족 등록 테스트
1. 신규 가족 등록 (대표자 신규)
2. 기존 성도로 가족 등록
3. 중복 가족명 등록 시도
4. 필수 항목 누락 시 처리

#### 구성원 관리 테스트
1. 기존 성도를 가족에 추가
2. 신규 성도를 가족에 추가
3. 구성원 관계 변경
4. 구성원 가족에서 제거

#### 권한 테스트
1. 관리자 권한으로 모든 가족 접근
2. 가족 대표자 권한으로 본인 가족만 접근
3. 일반 구성원 권한으로 제한된 접근
4. 권한 없는 사용자의 접근 차단

### 성능 테스트
- **대용량 데이터**: 1000+ 가족 데이터 처리
- **동시 접근**: 여러 사용자 동시 접근 처리
- **검색 성능**: 복합 조건 검색 응답 시간
- **페이지 로딩**: 가족 목록 페이지 로딩 시간

## 🎯 성공 지표

### 기술적 지표
- **페이지 로딩 시간**: 3초 이하
- **검색 응답 시간**: 1초 이하
- **데이터 정확도**: 99.9% 이상
- **시스템 가용성**: 99.5% 이상

### 사용성 지표
- **사용자 만족도**: 4.0/5.0 이상
- **기능 사용률**: 주요 기능 80% 이상 사용
- **오류 발생률**: 1% 이하
- **문의 빈도**: 주 2건 이하

## 📚 관련 문서
- [성도관리 요구사항 정의서](./member-management-requirements.md)
- [개발 로드맵](./development-roadmap.md)
- [데이터베이스 스키마 문서](../ittlc_be/database_schema.sql)

---

**작성자**: 개발팀  
**검토자**: -  
**승인일**: 2024-12-19 